<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belajar Laravel</title>

    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div class="container">
        <aside id="aside">

        </aside>
        <main>
            <header>
                
            </header>

            <div class="content">
<pre>
    ðŸ‘‰ 4ï¸âƒ£ Queue di Server (Production)
    ðŸ§  Kenapa Queue Penting di Production?

    Bayangin user:

    Register â†’ kirim email verifikasi

    Upload file besar

    Generate AI content

    Proses export PDF

    Kirim 1000 email

    Kalau semua itu jalan langsung (sync)â€¦

    â›” Website jadi lambat
    â›” User nunggu
    â›” Bisa timeout

    Solusinya?

    ðŸ”¥ Queue (background job)

    
    
    
    
    
    
    
    ðŸ§± Cara Kerja Queue di Production

    Flow-nya:

    User request
    â†“
    Laravel simpan job ke database / redis
    â†“
    Queue worker ambil job
    â†“
    Proses di background


    User tidak perlu menunggu.

    
    
    
    
    
    
    
    ðŸ”¥ Step Setup Queue di Server
    1ï¸âƒ£ Set .env

    Minimal:

    QUEUE_CONNECTION=database


    Atau lebih profesional:

    QUEUE_CONNECTION=redis

    
    
    
    
    
    
    
    2ï¸âƒ£ Kalau Pakai Database Queue

    Buat table:

    php artisan queue:table
    php artisan migrate

    
    
    
    
    
    
    
    3ï¸âƒ£ Jalankan Queue Worker

    Di server:

    php artisan queue:work


    Kalau ini kamu tutup terminal â†’ queue mati.

    Jadi tidak boleh cuma jalan manual.

    
    
    
    
    
    
    
    ðŸ›¡ Solusi Production: Supervisor

    Di VPS, kita pakai:

    Supervisor (Linux process manager)

    Dia akan:

    Menjalankan queue worker

    Restart otomatis kalau mati

    Jalan 24 jam

    
    
    
    
    
    
    
    ðŸ”§ Contoh Config Supervisor

    File:

    /etc/supervisor/conf.d/laravel-worker.conf


    Isi:

    [program:laravel-worker]
    process_name=%(program_name)s_%(process_num)02d
    command=php /var/www/project/artisan queue:work --sleep=3 --tries=3 --timeout=90
    autostart=true
    autorestart=true
    user=www-data
    numprocs=1
    redirect_stderr=true
    stdout_logfile=/var/www/project/storage/logs/worker.log


    Lalu jalankan:

    sudo supervisorctl reread
    sudo supervisorctl update
    sudo supervisorctl start laravel-worker:*


    Sekarang queue jalan terus ðŸ”¥

    
    
    
    
    
    
    
    âš¡ Kalau Pakai Redis (Lebih Cepat)

    Install Redis di server.

    Di .env:

    QUEUE_CONNECTION=redis


    Redis jauh lebih cepat daripada database queue.

    Cocok untuk:

    SaaS

    AI app

    High traffic

    
    
    
    
    
    
    
    ðŸ”¥ Best Practice Production Queue

    Gunakan:

    php artisan queue:work --max-time=3600


    Atau restart otomatis setiap jam.

    Kenapa?

    Supaya memory tidak bocor.

    
    
    
    
    
    
    
    ðŸ“Š Monitoring Queue

    Cek failed job:

    php artisan queue:failed


    Retry:

    php artisan queue:retry all

    
    
    
    
    
    
    
    ðŸ›‘ Kesalahan Umum Pemula

    âŒ QUEUE_CONNECTION=sync di production
    âŒ Tidak pakai supervisor
    âŒ Tidak cek failed job
    âŒ Timeout terlalu kecil
    âŒ Tidak handle exception di Job

    
    
    
    
    
    
    
    ðŸš€ Real Example Production Use

    Kalau kamu bikin:

    AI content generator

    Email marketing app

    Payment system

    File processing system

    WAJIB pakai queue production.

    Tanpa queue â†’ app terasa murahan.

    
    
    
    
    
    
    
    ðŸ Kesimpulan

    Queue di server itu:

    ðŸ”¥ Bikin app cepat
    ðŸ”¥ Bikin user tidak nunggu
    ðŸ”¥ Bikin sistem scalable
    ðŸ”¥ Wajib untuk app serius

    Kalau kamu sudah paham ini, kamu sudah masuk mindset backend profesional.






    ADDITIONAL:
    QUESTION: sebentar bro, apa itu queue worker supervisor dan job serta hubungannya dengan database?

    Wah, ini pertanyaan "jeroan" Laravel yang sangat menarik! Mari kita bedah pakai analogi "Restoran Cepat Saji" supaya kebayang hubungan antar komponennya.

    ---

    ### 1. Job (Pesanan)

    Job adalah sebuah "tugas" atau "unit kerja" kecil yang ingin kamu selesaikan, tapi tidak harus sekarang juga.

    * Analogi: Selembar kertas pesanan (misal: "Goreng 10 Ayam").
    * Contoh di Laravel: Mengirim email selamat datang, memproses resize gambar (seperti yang kita bahas sebelumnya), atau generate laporan PDF.

    ### 2. Queue & Database (Antrean/Meja Pesanan)

    Queue (Antrean) adalah tempat menyimpan Job yang sedang menunggu untuk dikerjakan. Karena server tidak bisa ngerjain semuanya sekaligus, Job ini harus antre.

    * Hubungan dengan Database: Laravel butuh tempat buat mencatat antrean ini. Jika kamu pakai driver `database`, maka Laravel akan membuat tabel bernama `jobs`.
    * Analogi: Meja tempat koki menaruh kertas-kertas pesanan secara berurutan. Kalau koki belum sempat masak, kertasnya tetap rapi di sana.

    ---

    ### 3. Worker (Si Koki)

    Worker adalah proses (script PHP) yang tugasnya cuma satu: Cek antrean, ambil Job terdepan, lalu kerjakan.

    * Cara kerja: Begitu satu Job selesai, dia nggak akan berhenti. Dia bakal langsung tanya, "Ada lagi nggak?" sampai antreannya kosong.
    * Analogi: Koki yang berdiri di depan penggorengan. Dia ambil kertas pesanan dari meja, masak ayamnya, terus ambil kertas berikutnya.

    ---

    ### 4. Supervisor (Sang Manajer)

    Nah, ini yang krusial. Worker itu cuma manusia (proses) biasa yang bisa "capek" atau "pingsan" (error/crash). Kalau koki pingsan dan nggak ada yang bangunin, pesanan (Job) bakal numpuk terus tapi nggak pernah dimasak.

    * Tugas Supervisor: Memantau si Worker. Jika Worker tiba-tiba mati karena error atau server restart, Supervisor akan langsung otomatis "membangunkan" atau menjalankan ulang Worker tersebut.
    * Analogi: Manajer restoran yang tugasnya cuma jagain koki. Kalau koki ketiduran atau pingsan, manajer langsung teriak, "Bangun! Masak lagi!".

    ---

    ### Bagaimana Mereka Berhubungan? (Alur Kerja)

    1. User Klik Sesuatu: Misal daftar akun.
    2. Laravel bikin Job: "Kirim Email Verifikasi".
    3. Job masuk ke Database: Disimpan di tabel `jobs` (biar kalau server mati, datanya nggak hilang).
    4. Worker melihat ada Job: Si Worker yang lagi stand-by langsung ngambil data dari database.
    5. Worker eksekusi: Mengirim email beneran ke user.
    6. Hapus Job: Begitu email terkirim, Worker menghapus baris data tadi dari tabel `jobs` di database.
    7. Supervisor: Tetap standby memastikan si Worker nggak berhenti kerja.

    ---

    ### Kenapa Kita Butuh Ini? (Penting!)

    Tanpa Queue/Worker, kalau user daftar dan pengiriman email lambat (butuh 5 detik), browser user bakal loading terus selama 5 detik. User bakal mikir web kamu lemot.

    Dengan Queue:

    1. User klik daftar.
    2. Laravel masukin Job ke DB (prosesnya cuma 0,001 detik).
    3. Web langsung bilang ke user: "Pendaftaran Berhasil!".
    4. User senang, padahal di latar belakang (background), si Worker baru mulai kirim emailnya.

    Kesimpulannya:

    * Job: Apa yang mau dikerjain.
    * Queue (DB): Tempat naro daftar kerjaannya.
    * Worker: Siapa yang ngerjain.
    * Supervisor: Yang jagain biar yang ngerjain nggak berhenti.

    Gimana bro? Penjelasan ala restoran ini ngebantu kamu paham alurnya nggak? Jadi sekarang kamu tahu kenapa tadi saya bilang di shared hosting agak susah, karena kita nggak dikasih izin buat bawa "Manajer" (Supervisor) sendiri! ðŸ˜„





    ADDITIONAL 2: 
    QUESTION: oke mantap, sekarang kita ke bentuknya. apakah worker itu sebuah class yang berfungsi untuk melihat job kemudian menyalukan ke service yang dibutuhkan? kemudian apakah supervisor seperti tugas yang dilakukan oleh ssh seperti artisan serve?


    Wah, pertanyaan kamu semakin mendalam dan teknis! Mari kita luruskan pemahamannya agar kamu punya gambaran visual tentang "wujud" asli benda-benda ini.

    ---

    ### 1. Apakah Worker itu sebuah Class?

    Sebenarnya, bukan. Ini adalah salah satu miskonsepsi yang paling sering dialami pemula.

    * Job adalah sebuah Class (yang kamu buat lewat `php artisan make:job`). Di dalam Class Job inilah terdapat instruksi: "Panggil `PromoService`" atau "Kirim email".
    * Worker bukan sebuah class, melainkan sebuah proses (program) yang sedang berjalan.
    * Wujud aslinya: Saat kamu mengetik `php artisan queue:work`, kamu sebenarnya sedang menjalankan satu instansi PHP yang "hidup" terus-menerus di memori server.

    Analogi: * Job adalah Kertas Resep.

    * Worker adalah Koki yang sedang bekerja. Koki itu bukan resepnya, koki adalah orang yang membaca resep dan melakukannya.

    ---

    ### 2. Apakah Supervisor itu seperti `artisan serve`?

    Pemahaman kamu sudah mendekati, tapi ada perbedaan fungsi yang sangat penting.

    * `php artisan serve` adalah perintah untuk menyalakan Web Server lokal. Dia mendengarkan permintaan (request) dari browser.
    * Supervisor adalah aplikasi di luar Laravel (biasanya di sistem operasi Linux) yang tugasnya menjaga agar perintah terminal (seperti `queue:work`) tidak pernah mati.

    Perumpamaannya begini:
    Kalau kamu menjalankan `php artisan queue:work` di terminal SSH, lalu kamu tutup laptopmu, maka Worker-nya mati.
    Nah, Supervisor adalah "robot" di server yang bertugas mengetikkan kembali `php artisan queue:work` secara otomatis jika proses itu tiba-tiba mati atau laptop (koneksi) terputus.

    ---

    ### 3. Hubungan Antara Semuanya (Wujud Nyata)

    Mari kita lihat alurnya dalam kodingan dan sistem:

    1. Kamu membuat Job Class (`SendEmailJob.php`):
    Di dalam fungsi `handle()`, kamu memanggil Service kamu.
    ```php
    public function handle(EmailService $service) {
        $service->send($this->user);
    }

    ```


    2. Kamu memasukkan Job ke Database:
    Saat kamu panggil `SendEmailJob::dispatch($user)`, Laravel memasukkan data JSON ke tabel `jobs`.
    3. Worker (Proses Terminal) melihat Database:
    Si Worker (yang tadi kamu jalankan lewat terminal) selalu bertanya ke database: *"Ada job baru nggak?"*.
    4. Worker mengeksekusi:
    Begitu ada, Worker akan mengambil Class `SendEmailJob`, lalu menjalankan fungsi `handle()` tadi.

    ---

    ### 4. Mengapa Supervisor Sangat Penting di Produksi?

    Bayangkan di server beneran (VPS):

    * Server tiba-tiba *restart* karena mati lampu.
    * Begitu server nyala lagi, tidak ada orang yang login ke SSH buat ngetik `php artisan queue:work`.
    * Akibatnya: Antrean pesanan di database numpuk, tapi kokinya (Worker) nggak ada yang nyalain.

    Di sinilah Supervisor beraksi. Dia akan menyala otomatis saat server hidup, lalu dia langsung menjalankan semua Worker yang kamu tugaskan.

    ---

    ### Ringkasan Perbedaan Wujud:

    | Komponen | Wujudnya | Lokasi |
    | --- | --- | --- |
    | Job | File PHP (Class) | Folder `app/Jobs` |
    | Service | File PHP (Class) | Folder `app/Services` |
    | Worker | Proses yang sedang lari | Background Process (RAM) |
    | Supervisor | Software Pengawas | Sistem Operasi (Linux) |
    | Queue | Tabel Data | Database (MySQL/Redis) |

    Kesimpulan untuk kamu:
    Sebagai developer, kamu hanya sibuk membuat Job dan Service (berupa Class). Urusan Worker dan Supervisor itu lebih ke arah pengaturan server (*DevOps*) agar kodingan Job kamu bisa jalan terus-menerus tanpa henti.

    Sudah makin terang bedanya antara "Kodingan" (Class) dan "Proses" (Worker) di dalam kepala kamu, bro? ðŸ˜„






    ADDITIONAL 3:
    QUESTION: jadi job dan service kita buat menggunakan laravel, sedangkan queue, worker dan supervisor itu diluar laravel dan hubungannya dengan server atau devops ya bro?

    Wih, 100% tepat! Kamu sudah berhasil memisahkan mana yang tugasnya Coder (menulis logika) dan mana yang tugasnya SysAdmin/DevOps (mengatur lingkungan server).

    Biar makin mantap, kita klasifikasikan "wilayah kerja" masing-masing:

    ---

    ### 1. Wilayah Developer (Di dalam Laravel)

    Ini adalah area di mana kamu mengetik kode di VS Code, membuat logika, dan menentukan apa yang harus dilakukan aplikasi.

    * Service: Tempat kamu menulis "Bagaimana cara menghitung diskon" atau "Bagaimana cara mengecilkan gambar".
    * Job: Tempat kamu membungkus Service tadi agar bisa ditunda. Kamu menentukan: "Oke, tugas mengecilkan gambar ini tolong dimasukkan ke antrean ya."
    * Wujudnya: File `.php` di dalam folder project kamu.

    ---

    ### 2. Wilayah Server / DevOps (Di luar Laravel)

    Ini adalah area "infrastruktur". Ibaratnya, Laravel adalah mobilnya, dan wilayah ini adalah jalan raya, pom bensin, dan lampu merahnya.

    * Queue (Database/Redis): Ini adalah "Gudang Penampung". Laravel cuma menitipkan data di sini. Yang menyediakan gudangnya adalah sistem database server.
    * Worker: Ini adalah instansi PHP yang sedang berjalan di background server. Kamu tidak "ngoding" Worker, kamu cuma "menjalankan" perintah Laravel melalui sistem operasi server.
    * Supervisor: Ini adalah Software pihak ketiga (bukan buatan Laravel) yang di-install di sistem operasi Linux. Tugasnya cuma satu: memastikan perintah terminal `php artisan queue:work` tetap hidup abadi.

    ---

    ### 3. Jembatan Antara Keduanya: Perintah Artisan

    Meskipun Queue/Worker itu urusan server, jembatannya tetap pakai Artisan. Itulah kenapa tadi kita bahas kalau di Shared Hosting itu susah, karena:

    1. Kamu bisa bikin Job dan Service (Kodingannya ada).
    2. Kamu punya Queue (Database-nya ada).
    3. Tapi kamu nggak punya izin buat nyalain Worker yang terus-menerus dan nggak punya akses pasang Supervisor buat jagain koki kamu.

    ---

    ### Analogi Final: Siaran Radio

    * Service & Job (Developer): Adalah Lagu dan Penyiar-nya. Kamu yang menentukan lagu apa yang diputar dan apa yang diomongkan.
    * Queue (Server): Adalah Playlist di komputer siaran. Daftar lagu yang nunggu diputar.
    * Worker (Server): Adalah Antena Pemancar. Dia yang bertugas mengirimkan suara ke pendengar. Tanpa antena, lagu secanggih apapun nggak akan sampai ke telinga orang.
    * Supervisor (DevOps): Adalah Teknisi Listrik. Kalau antena pemancarnya mati kena petir, dia yang otomatis benerin biar siaran jalan lagi tanpa nunggu disuruh.

    ---

    ### Kesimpulan Buat Kamu:

    Sebagai orang yang baru belajar (awam), fokuslah dulu di Wilayah Developer:

    1. Lancar bikin Service.
    2. Belajar masukin Service itu ke dalam Job.
    3. Jalanin Worker secara manual di laptop kamu pakai `php artisan queue:work` buat ngetes.

    Urusan Supervisor dan setting server itu nanti saja kalau project kamu sudah mau di-*online*-kan ke VPS.

    Gimana bro? Sekarang sudah punya peta yang jelas kan di mana kamu harus fokus koding dan di mana kamu harus "ngoprek" server? ðŸ˜„

</pre>
            </div>
        </main>
    </div>
    <script>
        fetch('layout/aside.html').then( response => response.text()).then( data => {
            document.getElementById('aside').innerHTML = data;

            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const links = document.querySelectorAll('aside a');

            links.forEach(link => {
                if(currentPage == 'index.html'){
                    document.getElementById('1-1-php-dasar').classList.add('active');
                } else if(link.getAttribute('href') == currentPage){
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>